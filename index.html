<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</title>
  <link rel="stylesheet" href="css/site.css">
</head>
<body>
  <div id="site-menu"></div>
  <script src="scripts/load-menu.js" defer></script>
  <div class="container">
    <h1>üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h1>
    <table id="data-table">
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Customer Name</th>
          <th>Total Amount</th>
          <th>Paid</th>
        </tr>
      </thead>
      <tbody>
        <!-- Data will be dynamically inserted here -->
      </tbody>
    </table>
  </div>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxI_onG1cy47WNP4j3_HrmSGyBwL9XGFwZBTZtZtnQTaI6y0N6sPL_9hP_XrCd76BI/exec'; // Use your actual web app URL here

    async function fetchData() {
      try {
        const response = await fetch(SCRIPT_URL);
        const data = await response.json();
        populateTable(data);
      } catch (error) {
        console.error('Error fetching data:', error);
      }
    }

    function populateTable(data) {
      const tableBody = document.querySelector('#data-table tbody');
      tableBody.innerHTML = '';
      data.forEach(order => {
        const row = document.createElement('tr');
        const payButton = !order.paid ? `<button onclick="payOrder('${order.orderId}', ${order.totalAmount})">Pay</button>` : '';
        row.innerHTML = `
          <td>${order.orderId}</td>
          <td>${order.customerName}</td>
          <td>${order.totalAmount}</td>
          <td>${order.paid ? 'Yes' : payButton}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    async function payOrder(orderId, totalAmount) {
      const paymentMethods = ['QR code', '‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå', '‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î'];

      // Create a modal for payment method selection
      const modal = document.createElement('div');
      modal.style.position = 'fixed';
      modal.style.top = '0';
      modal.style.left = '0';
      modal.style.width = '100%';
      modal.style.height = '100%';
      modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
      modal.style.display = 'flex';
      modal.style.justifyContent = 'center';
      modal.style.alignItems = 'center';
      modal.style.zIndex = '1000';

      const modalContent = document.createElement('div');
      modalContent.style.backgroundColor = '#fff';
      modalContent.style.padding = '20px';
      modalContent.style.borderRadius = '8px';
      modalContent.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
      modalContent.innerHTML = '<h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</h3>';

      const list = document.createElement('ul');
      list.style.listStyleType = 'none';
      list.style.padding = '0';

      paymentMethods.forEach((method, index) => {
        const listItem = document.createElement('li');
        listItem.style.margin = '10px 0';

        const button = document.createElement('button');
        button.textContent = method;
        button.style.padding = '10px 20px';
        button.style.border = 'none';
        button.style.borderRadius = '4px';
        button.style.backgroundColor = '#007BFF';
        button.style.color = '#fff';
        button.style.cursor = 'pointer';

        button.addEventListener('click', async () => {
          document.body.removeChild(modal);
          try {
            const response = await fetch(SCRIPT_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ orderId, paidAmount: totalAmount, paymentMethod: method })
            });
            let result;
            if (response.ok) {
              try {
                result = await response.json();
              } catch (jsonErr) {
                alert('Payment failed: Invalid JSON response');
                return;
              }
              if (result.success) {
                alert('Payment successful!');
                fetchData();
              } else {
                alert('Payment failed: ' + (result.message || 'Unknown error'));
              }
            } else {
              const text = await response.text();
              alert('Payment failed: ' + response.status + ' ' + text);
            }
          } catch (error) {
            alert('Payment failed: ' + error.message);
            console.error('Error processing payment:', error);
          }
        });

        listItem.appendChild(button);
        list.appendChild(listItem);
      });

      modalContent.appendChild(list);
      modal.appendChild(modalContent);
      document.body.appendChild(modal);
    }

    fetchData();
  </script>
</body>
</html>
