<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</title>
  <link rel="stylesheet" href="css/site.css">
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f7f7f7; margin: 0; }
    .container { max-width: 420px; margin: 24px auto; background: #fff; border-radius: 16px; box-shadow: 0 4px 24px rgba(0,0,0,0.08); padding: 24px; }
    h1 { font-size: 1.4rem; margin-bottom: 8px; text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 16px; }
    th, td { padding: 8px 4px; text-align: left; }
    th { background: #e3e7ff; font-size: 0.95rem; }
    td input[type=number] { width: 50px; padding: 4px; font-size: 1rem; border-radius: 6px; border: 1px solid #ccc; }
    .btn { width: 100%; padding: 12px; background: linear-gradient(90deg,#667eea,#764ba2); color: #fff; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 700; cursor: pointer; margin-top: 8px; }
    #status { margin: 12px 0; text-align: center; font-size: 1rem; }
    .total { font-weight: bold; color: #2e7d32; text-align: right; margin-bottom: 8px; }
    @media (max-width: 500px) { .container { padding: 8px; } th, td { font-size: 0.95rem; } }
  </style>
</head>
<body>
  <div id="site-menu"></div>
  <script src="scripts/load-menu.js" defer></script>
  <div class="container">
    <h1>üõçÔ∏è ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
    <form id="orderForm">
      <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á <input type="text" id="customerName" required class="input--wide-70"></label>
      <table>
        <thead>
          <tr><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th></tr>
        </thead>
        <tbody id="orderTable"></tbody>
      </table>
      <div class="total" id="totalAmount">‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô: 0 ‡∏ö‡∏≤‡∏ó</div>
      <button type="submit" class="btn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
    </form>
    <div id="status"></div>
  </div>
  <script>
    let items = [];
    function loadSeller() {
      google.script.run.withSuccessHandler(function(itemsRes) {
        items = itemsRes || [];
        const table = document.getElementById('orderTable');
        table.innerHTML = '';
        items.slice(0,5).forEach(item => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${item.itemId}</td><td>${item.name}</td><td>${item.price}</td><td><input type='number' min='0' value='0' data-id='${item.itemId}' data-price='${item.price}'></td>`;
          table.appendChild(tr);
        });
      }).apiGetSeller();
    }
    function calcTotal() {
      let total = 0;
      document.querySelectorAll('#orderTable input').forEach(input => {
        total += (parseInt(input.value)||0) * (parseFloat(input.dataset.price)||0);
      });
      document.getElementById('totalAmount').textContent = '‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô: ' + total + ' ‡∏ö‡∏≤‡∏ó';
      return total;
    }
    document.getElementById('orderTable').addEventListener('input', calcTotal);
    document.getElementById('orderForm').addEventListener('submit', async e => {
      e.preventDefault();
      const status = document.getElementById('status');
      status.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
      const customerName = document.getElementById('customerName').value.trim();
      const orders = {};
      document.querySelectorAll('#orderTable input').forEach(input => {
        const qty = parseInt(input.value)||0;
        if(qty>0) orders[input.dataset.id] = { qty, price: parseFloat(input.dataset.price) };
      });
      if(Object.keys(orders).length===0) { status.textContent = '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤'; return; }
      const totalAmount = calcTotal();
      google.script.run.withSuccessHandler(function(result) {
        if (result && result.success) {
          status.textContent = '‚úÖ ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
          document.getElementById('orderForm').reset();
          calcTotal();
        } else {
          status.textContent = '‚ùå ' + (result && result.message ? result.message : '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
        }
      }).apiCreateOrder({ customerName, orders, totalAmount });
    });
    loadSeller();
    calcTotal();
  </script>
</body>
</html>
